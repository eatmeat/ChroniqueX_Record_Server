# ChroniqueX Record Server

## Обзор
ChroniqueX Record Server - это настольное приложение, которое обеспечивает возможность аудиозаписи с автоматической обработкой и интеграцией с API ChroniqueX для транскрибации и генерации протоколов.

Для получения API_KEY и пополнения баланса используйте нашего Telegram-бота: [@ChroniqueX_bot](https://t.me/ChroniqueX_bot)

Официальный сайт проекта: [https://www.chroniquex.ru/](https://www.chroniquex.ru/)

## Возможности
- **Аудиозапись**: Высококачественная аудиозапись с возможностью приостановки/продолжения
- **Автоматическая обработка**: Записи автоматически сжимаются в MP3 и отправляются на обработку
- **Веб-интерфейс**: Встроенный веб-интерфейс, доступный через браузер
- **Интеграция с API**: Бесшовная интеграция с API ChroniqueX для транскрибации и генерации протоколов
- **Приложение в трее**: Работает в системном трее с удобными элементами управления
- **Постобработка**: Автоматическая транскрибация и генерация протоколов из записей

## Требования
- Python 3.8+
- Необходимые Python-пакеты (устанавливаются с помощью `pip install -r req.txt`):
  - pyaudio
  - pyaudiowpatch
  - requests
  - flask
  - pydub
  - pystray
  - pillow
  - python-dotenv

## Конфигурация
1. Создайте файл `.env` в той же директории со следующими переменными:
   ```
   API_URL=https://www.chroniquex.ru:16040
   API_KEY=ваш_ключ_api_здесь
   ```

2. Приложение создаст файл `record_server_settings.json` со следующими настройками по умолчанию:
   ```json
   {
       "port": 8288,
       "server_enabled": true,
       "lan_accessible": false,
       "use_custom_prompt": false,
       "prompt_addition": "",
       "include_html_files": true,
       "main_window_width": 700,
       "main_window_height": 800,
       "main_window_x": null,
       "main_window_y": null
   }
   ```

## Использование

### Запуск приложения
Запустите приложение с помощью:
```bash
python recordServer.pyw
```

### Веб-интерфейс
После запуска сервер будет доступен по адресу:
- `http://localhost:8288` (порт по умолчанию)

Веб-интерфейс предоставляет:
- Элементы управления записью
- Доступ к записанным файлам
- Мониторинг состояния
- Настройки конфигурации

### Доступные эндпоинты
- `GET /` - Главный веб-интерфейс
- `GET /rec` - Начать запись
- `GET /stop` - Остановить запись
- `GET /pause` - Приостановить запись
- `GET /resume` - Продолжить запись
- `GET /status` - Получить состояние записи
- `GET /files/<path:filepath>` - Обслуживание записанных файлов
- `POST /shutdown` - Завершить работу сервера

### Элементы управления записью
Приложение работает в системном трее со следующими элементами управления:
- **Начать запись**: Начать аудиозапись
- **Приостановить запись**: Временно приостановить запись
- **Продолжить запись**: Продолжить приостановленную запись
- **Остановить запись**: Завершить текущую сессию записи

## Рабочий процесс постобработки
1. Аудио записывается и сохраняется как WAV файл
2. WAV файл автоматически конвертируется в MP3
3. Оригинальный WAV файл удаляется после конвертации
4. MP3 файл отправляется в API ChroniqueX для транскрибации
5. Результат транскрибации сохраняется как TXT файл
6. Протокол генерируется из транскрибации и сохраняется как PDF

## Пользовательские промпты
Вы можете настроить генерацию протокола, включив пользовательские промпты в настройках:
- Используйте плейсхолдер `{current_date}` для автоматической вставки даты
- Строки, начинающиеся с `//`, будут игнорироваться при обработке
- HTML файлы в той же директории могут быть включены в контекст

## Настройка сети
- По умолчанию сервер доступен только локально
- Включите "Доступен по локальной сети" в настройках, чтобы разрешить доступ с других устройств в сети
- Сервер будет доступен по адресу `http://[ваш_ip]:[порт]` с других устройств

## Настройка брандмауэра
- При первом запуске Windows может запросить разрешение на доступ к брандмауэру для Python или для этого приложения
- Убедитесь, что порт 8288 открыт в брандмауэре, если вы планируете использовать доступ по локальной сети
- Для ручной настройки брандмауэра Windows:
  1. Откройте "Брандмауэр Защитника Windows"
  2. Выберите "Разрешить доступ к приложению через брандмауэр"
  3. Нажмите "Добавить порт..."
  4. Укажите:
     - Тип: TCP
     - Порт: 8288
     - Имя: ChroniqueX Record Server
  5. Убедитесь, что галочка установлена для сетей, через которые нужно разрешить доступ (частная, публичная)

## Устранение неполадок
- Если вы сталкиваетесь с ошибками аудиоустройства, убедитесь, что микрофон правильно подключен
- Проверьте, что API_URL и API_KEY в вашем файле `.env` указаны правильно
- Убедитесь, что сервер API ChroniqueX запущен и доступен
- Проверьте вывод консоли на наличие сообщений об ошибках

## Безопасность
- Приложение подключается к API ChroniqueX с использованием HTTPS
- Ключи API хранятся в файле `.env` (храните этот файл в безопасности)
- Проверка SSL-сертификата отключена для самоподписанных сертификатов (для разработки)

## Лицензия
Этот продукт предоставляется как есть, без каких-либо гарантий.